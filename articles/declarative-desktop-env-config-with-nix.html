<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Declarative Desktop Environment Configuration on NixOS - mjones.network</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././docs/custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">README.md</a></li><li class="chapter-item expanded affix "><a href="../my-dotfiles.html">My Dotfiles</a></li><li class="chapter-item expanded affix "><a href="../ublock-filters.html">Useful uBlock Origin Filters</a></li><li class="chapter-item expanded affix "><li class="part-title">Articles</li><li class="chapter-item expanded "><a href="../articles/github-neovim-1password-cli.html"><strong aria-hidden="true">1.</strong> Bringing my GitHub workflow into Neovim using 1Password CLI</a></li><li class="chapter-item expanded "><a href="../articles/declarative-desktop-env-config-with-nix.html" class="active"><strong aria-hidden="true">2.</strong> Declarative Desktop Environment Configuration on NixOS</a></li><li class="chapter-item expanded "><a href="../articles/linux-isnt-for-nerds-anymore.html"><strong aria-hidden="true">3.</strong> It's 2024 and Linux Isn't Just for Nerds Anymore</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">mjones.network</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="declarative-configuration-for-desktop-environments-on-nixos"><a class="header" href="#declarative-configuration-for-desktop-environments-on-nixos">Declarative Configuration for Desktop Environments on NixOS</a></h1>
<p>As soon as I tried out Nix, I wanted to use Nix for <em>everything.</em> With Nix, all your configuration is <em>reproducible</em> (as long as you
stay in pure mode, that is), which is amazing if you need to share configurations across devices.</p>
<p>For the sake of this article, I'll assume you have a working knowledge of Nix and NixOS.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<p>Building on top of Nix, <a href="https://github.com/nix-community/home-manager"><code>home-manager</code></a> is great for managing non-global packages
and dotfiles. It also has a module called <code>dconf</code> that allows you to declaratively define <a href="https://wiki.gnome.org/HowDoI/GSettings"><code>gsettings</code></a>, a settings system for GNOME and related desktop environments.</p>
<p>Using the <code>dconf</code> module, you can configure everything from your system dark theme, desktop background image, and global keyboard
shortcuts declaratively using Nix.</p>
<p>First you need to enable <code>dconf</code>; in your <code>/etc/nixos/configuration.nix</code> or <code>flake.nix</code> add:</p>
<pre><code class="language-nix">{ pkgs, ... }: { programs.dconf.enable = true; }
</code></pre>
<p>Then, in your <code>home-manager</code> configuration, you can start configuring your desktop environment using <code>dconf</code>.</p>
<pre><code class="language-nix">{ pkgs, ... }: {
  dconf.settings = {
    # place your dconf settings here
    "some/settings/namespace" = { some-setting = "some-value"; };
  };
}
</code></pre>
<h2 id="finding-the-correct-settings-namespaces-and-keys"><a class="header" href="#finding-the-correct-settings-namespaces-and-keys">Finding the Correct Settings Namespaces and Keys</a></h2>
<p>Now that you've enabled <code>dconf</code> in your NixOS configuration, we can use <code>dconf</code> from the command line to figure out what the
namespaces and keys are for the settings you want to set declaratively in Nix. To do this, open a new terminal window and run
<code>dconf watch /</code>. This will start a process which will output any settings value that changes.</p>
<p>Now, change your desired settings from the settings GUI, and observe the output from <code>dconf watch /</code>. For example,
changing your wallpaper image from the settings GUI should output something like:</p>
<pre><code>/org/gnome/desktop/background/picture-uri
  'file:///home/mat/.local/share/backgrounds/2023-06-15-14-59-58-wallpaper.jpg'
</code></pre>
<h2 id="declarative-settings"><a class="header" href="#declarative-settings">Declarative Settings</a></h2>
<p>With this information, you can set your desktop wallpaper declaratively within your <code>home-manager</code> configuration. You can use
<code>pkgs.fetchurl</code> to fetch the desired image file and set it as your desktop wallpaper:</p>
<pre><code class="language-nix">{ pkgs, ... }:
let
  wallpaperImg = pkgs.fetchurl {
    url = "https://url/to/your/image";
    # replace this with the SHA256 hash of the image file
    hash = "sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";
  };
in {
  dconf.settings = {
    "org/gnome/desktop/background" = {
      picture-uri = "file://${wallpaperImg}";
    };
  };
}
</code></pre>
<p>With this added, applying your <code>home-manager</code> configuration will change your desktop wallpaper!
You can use this method to find just about all the settings you'll need, although some of them might
require some fiddling with.</p>
<p>For example, creating custom keyboard shortcuts is slightly more complex. First, you have to specify
each custom shortcut group that should exist, then you can specify the shortcuts themselves. For example:</p>
<pre><code class="language-nix">{ pkgs, ... }: {
  dconf.settings = {
    "org/gnome/settings-daemon/plugins/media-keys" = {
      # specify that custom shortcut "custom0" should exist and be included
      custom-keybindings = [
        "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/"
      ];
      terminal = [ "" ];
    };
    # now you can specify the "custom0" shortcut itself
    "org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0" =
      {
        binding = "Print"; # printscrn key
        command = "flameshot gui";
        name = "flameshot";
      };
  };
}
</code></pre>
<p>Feel free to take a look at all the current settings I use at time of writing <a href="https://github.com/mrjones2014/dotfiles/tree/e3d1dc94b8cbfd108fa22e9bf58e77dca48bc70c/home-manager/modules/gnome">in my dotfiles repo</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../articles/github-neovim-1password-cli.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../articles/linux-isnt-for-nerds-anymore.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../articles/github-neovim-1password-cli.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../articles/linux-isnt-for-nerds-anymore.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
